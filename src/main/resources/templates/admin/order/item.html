<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/base-admin}" th:with="menu='order'">
<div layout:fragment="content-admin" class="container my-3">
    <div class="row mb-3">
        <div class="col-2">
            <div th:replace="~{layout/sidebar-admin :: sidebar-admin-fragment}"></div>
        </div>
        <div class="col-9">
            <h1>주문내역 리스트</h1>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end"></div>
            <table class="table table-sm">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>상품번호</th>
                    <th>상품상세번호</th>
                    <th>주문번호</th>
                    <th>상품이름</th>
                    <th>주문수량</th>
                    <th>상품금액</th>
                    <th>배송상태</th>
                    <th></th>
                    <th>송장번호</th>
                    <th>주문자</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="orders : ${orders}">
                    <td th:text="${ordersStat.index+1}">index</td>
                    <td>100</td>
                    <td align="center">150</td>
                    <td th:text="${orders.id}">4646-464</td>
                    <td>책상</td>
                    <td>2개</td>
                    <td th:text="${orders.totalPrice}">5,000</td>
                    <td>
                        <select th:id="${orders.id}" th:name="${orders.id}">
                            <option th:selected="${orders.orderStatus.id==1}" value="1">상품준비중</option>
                            <option th:selected="${orders.orderStatus.id==2}" value="2">배송중</option>
                            <option th:selected="${orders.orderStatus.id==3}" value="3">배송완료</option>
                            <option th:selected="${orders.orderStatus.id==4}" value="4">구매확정</option>
                            <option th:selected="${orders.orderStatus.id==5}" value="5">취소완료</option>
                            <option th:selected="${orders.orderStatus.id==6}" value="6">반품신청</option>
                            <option th:selected="${orders.orderStatus.id==7}" value="7">반품완료</option>
                            <option th:selected="${orders.orderStatus.id==8}" value="8">교환신청</option>
                            <option th:selected="${orders.orderStatus.id==9}" value="9">교환완료</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" th:onclick="|updateOrder(${orders.id})|">저장</button>
                    </td>
                    <td>151-118</td>
                    <td>홍길동</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</html>
<script type="text/javascript">
    function updateOrder(orderId) {
        let item = document.getElementById(orderId);

        let order = {
            id: orderId,
            orderStatus: {
                id: item.options[item.selectedIndex].value
            }
        };

        $.ajax({
            type: 'POST',
            url: '/admin/order/item',
            data: JSON.stringify(order),
            contentType: 'application/json',
            success: function(data) {
                if (data <= 0)
                    alert("상품배송 업데이트 실패하였습니다")
                else
                    alert("상품배송 업데이트가 완료되었습니다.")

            }
        });
    }
</script>